<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Saved Posts - Telegram Ban Bypass</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            font-weight: 700;
        }

        .back-link {
            display: inline-block;
            margin-bottom: 20px;
            color: #667eea;
            text-decoration: none;
            font-weight: 500;
            transition: transform 0.2s;
        }

        .back-link:hover {
            transform: translateX(-3px);
        }

        .filter-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }

        .filter-tab {
            padding: 10px 20px;
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
            font-size: 16px;
            border-bottom: 3px solid transparent;
            transition: all 0.2s;
        }

        .filter-tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #999;
        }

        .post-item {
            padding: 15px;
            margin-bottom: 12px;
            background: white;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
            transition: all 0.2s;
        }

        .post-item:hover {
            border-color: #667eea;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .post-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 10px;
        }

        .post-link {
            color: #667eea;
            text-decoration: none;
            font-weight: 500;
            font-size: 16px;
        }

        .post-link:hover {
            text-decoration: underline;
        }

        .post-note {
            margin-top: 8px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 6px;
            color: #333;
            font-size: 14px;
            line-height: 1.5;
        }

        .post-meta {
            font-size: 12px;
            color: #999;
            margin-top: 8px;
        }

        .post-actions {
            display: flex;
            gap: 8px;
        }

        .action-btn {
            padding: 4px 8px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        }

        .remove-btn {
            background: #dc3545;
            color: white;
        }

        .remove-btn:hover {
            background: #c82333;
        }

        .edit-btn {
            background: #28a745;
            color: white;
        }

        .edit-btn:hover {
            background: #218838;
        }

        .favorite-icon {
            color: #ffc107;
            margin-right: 5px;
        }

        @media (max-width: 768px) {
            body {
                padding: 0px;
            }

            .container {
                padding: 15px;
            }

            h1 {
                font-size: 1.8em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link">‚Üê Back to Channel Viewer</a>
        <h1>‚≠ê Saved Posts</h1>
        
        <div class="filter-tabs">
            <button class="filter-tab active" data-filter="all">All</button>
            <button class="filter-tab" data-filter="favorites">‚≠ê Favorites</button>
            <button class="filter-tab" data-filter="notes">üìù With Notes</button>
        </div>
        
        <div id="posts-container">
            <div class="empty-state">Loading saved posts...</div>
        </div>
    </div>

    <script>
        // Import PostNotesManager functionality
        class PostNotesManager {
            constructor() {
                this.storageKey = 'telegram_post_notes';
                this.favoritesKey = 'telegram_post_favorites';
                this.loadFromStorage();
            }
            
            loadFromStorage() {
                try {
                    const notes = localStorage.getItem(this.storageKey);
                    this.notes = notes ? JSON.parse(notes) : {};
                    
                    const favorites = localStorage.getItem(this.favoritesKey);
                    this.favorites = favorites ? JSON.parse(favorites) : {};
                } catch (error) {
                    console.error('Error loading post notes from localStorage:', error);
                    this.notes = {};
                    this.favorites = {};
                }
            }
            
            saveToStorage() {
                try {
                    localStorage.setItem(this.storageKey, JSON.stringify(this.notes));
                    localStorage.setItem(this.favoritesKey, JSON.stringify(this.favorites));
                } catch (error) {
                    console.error('Error saving post notes to localStorage:', error);
                }
            }
            
            getPostId(channel, postNumber) {
                return `${channel}_${postNumber}`;
            }
            
            setNote(channel, postNumber, note) {
                const postId = this.getPostId(channel, postNumber);
                if (note && note.trim()) {
                    this.notes[postId] = {
                        text: note.trim(),
                        timestamp: Date.now(),
                        channel: channel,
                        postNumber: postNumber
                    };
                } else {
                    delete this.notes[postId];
                }
                this.saveToStorage();
            }
            
            getNote(channel, postNumber) {
                const postId = this.getPostId(channel, postNumber);
                return this.notes[postId] || null;
            }
            
            toggleFavorite(channel, postNumber, postContent = '') {
                const postId = this.getPostId(channel, postNumber);
                if (this.favorites[postId]) {
                    delete this.favorites[postId];
                } else {
                    this.favorites[postId] = {
                        timestamp: Date.now(),
                        channel: channel,
                        postNumber: postNumber,
                        preview: postContent.substring(0, 100) + (postContent.length > 100 ? '...' : '')
                    };
                }
                this.saveToStorage();
                return this.isFavorite(channel, postNumber);
            }
            
            isFavorite(channel, postNumber) {
                const postId = this.getPostId(channel, postNumber);
                return !!this.favorites[postId];
            }
            
            getAllFavorites() {
                return Object.entries(this.favorites)
                    .map(([postId, data]) => ({ postId, ...data }))
                    .sort((a, b) => b.timestamp - a.timestamp);
            }
            
            getAllNotes() {
                return Object.entries(this.notes)
                    .map(([postId, data]) => ({ postId, ...data }))
                    .sort((a, b) => b.timestamp - a.timestamp);
            }
        }
        
        const postNotesManager = new PostNotesManager();
        let currentFilter = 'all';
        
        function formatDate(timestamp) {
            const date = new Date(timestamp);
            const now = new Date();
            const diffDays = Math.floor((now - date) / (1000 * 60 * 60 * 24));
            
            if (diffDays === 0) return 'Today';
            if (diffDays === 1) return 'Yesterday';
            if (diffDays < 7) return `${diffDays} days ago`;
            
            return date.toLocaleDateString();
        }
        
        function renderPosts() {
            const container = document.getElementById('posts-container');
            const favorites = postNotesManager.getAllFavorites();
            const notes = postNotesManager.getAllNotes();
            
            let posts = [];
            
            if (currentFilter === 'all' || currentFilter === 'favorites') {
                favorites.forEach(fav => {
                    const note = postNotesManager.getNote(fav.channel, fav.postNumber);
                    posts.push({
                        ...fav,
                        type: 'favorite',
                        note: note
                    });
                });
            }
            
            if (currentFilter === 'all' || currentFilter === 'notes') {
                notes.forEach(note => {
                    if (!posts.find(p => p.postId === note.postId)) {
                        posts.push({
                            ...note,
                            type: 'note',
                            isFavorite: postNotesManager.isFavorite(note.channel, note.postNumber)
                        });
                    }
                });
            }
            
            if (posts.length === 0) {
                container.innerHTML = `<div class="empty-state">No saved posts yet. Start adding favorites and notes from the channel viewer!</div>`;
                return;
            }
            
            container.innerHTML = posts.map(post => {
                const isFav = post.type === 'favorite' || post.isFavorite;
                const hasNote = post.note || post.text;
                
                return `
                    <div class="post-item">
                        <div class="post-header">
                            <div>
                                <a href="https://t.me/${post.channel}/${post.postNumber}" target="_blank" class="post-link">
                                    ${isFav ? '<span class="favorite-icon">‚òÖ</span>' : ''}@${post.channel}/${post.postNumber}
                                </a>
                                <div class="post-meta">
                                    Saved ${formatDate(post.timestamp)}
                                </div>
                            </div>
                            <div class="post-actions">
                                ${hasNote ? `
                                    <button class="action-btn edit-btn" onclick="editNote('${post.channel}', '${post.postNumber}')">
                                        Edit Note
                                    </button>
                                ` : `
                                    <button class="action-btn edit-btn" onclick="editNote('${post.channel}', '${post.postNumber}')">
                                        Add Note
                                    </button>
                                `}
                                <button class="action-btn remove-btn" onclick="removePost('${post.channel}', '${post.postNumber}', '${post.type}')">
                                    Remove
                                </button>
                            </div>
                        </div>
                        ${hasNote ? `
                            <div class="post-note">
                                ${post.note ? post.note.text : post.text}
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
        }
        
        function removePost(channel, postNumber, type) {
            if (type === 'favorite' || postNotesManager.isFavorite(channel, postNumber)) {
                if (confirm('Remove from favorites?')) {
                    postNotesManager.toggleFavorite(channel, postNumber);
                }
            }
            
            if (type === 'note' || postNotesManager.getNote(channel, postNumber)) {
                if (confirm('Delete note?')) {
                    postNotesManager.setNote(channel, postNumber, '');
                }
            }
            
            renderPosts();
        }
        
        function editNote(channel, postNumber) {
            const existingNote = postNotesManager.getNote(channel, postNumber);
            const noteText = prompt('Edit note:', existingNote ? existingNote.text : '');
            
            if (noteText !== null) {
                postNotesManager.setNote(channel, postNumber, noteText);
                renderPosts();
            }
        }
        
        // Filter tabs
        document.querySelectorAll('.filter-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.filter-tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                currentFilter = tab.dataset.filter;
                renderPosts();
            });
        });
        
        // Initial render
        renderPosts();
    </script>
</body>
</html>